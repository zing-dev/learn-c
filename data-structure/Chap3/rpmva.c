/*=============================================================
// �� �� ����rpmva(a,n,x,m,y)
// �������������ö�����ֵ�������һԪ����ʽ��ֵ
// ���������a������ʽϵ������n������ʽ�״Σ�
//        x��ָ����ֵ��,m��ָ����ֵ�ĸ�����,y�����ص�m������ʽֵ��
// �� �� ֵ�����ɹ��򷵻�1,���򷵻�0
//==============================================================*/
#include"math.h"
#include"stdlib.h"

int rpmva(a, n, x, m, y)

int n, m;
double *a, *x, *y;
{
int i, j, k, nn, nk, kk, l, count, tail;
double *ax, *b;
double a1, t1, t2;
k = log(n - 0.5) / log(2.0) + 1;    /* ��log2(k)*/
nn = 1;
for (
i = 0;
i<k;
i++)
nn = nn << 1;
nk = nn >> 1;
a1 = a[n - 1];        /* �������ϵ���Ƿ�Ϊ0��Ϊ0�Ļ��򷵻ء�*/
if(a1+1.0 == 1.0)
{
printf("(rpmva)coefficient too small,please check.\n");
return(0);
}
/* b�������ϵ���ֽ���м�����ax������ŵ�������Ľ��*/
b = (double *) malloc(nn * sizeof(double));
ax = (double *) malloc(nk * sizeof(double));
for(
i = 0;
i<n;
i++)        /* ϵ����1��*/
b[i] = a[i]/
a1;
for(
i = n;
i<nn;
i++)
b[i]=0.0;
l = nn >> 1;            /* l��ÿ�ηֶεĳ��ȣ�count�Ƿֶε��ܸ�����һ��*/
count = 1;
for(
i = 1;
i<k;
i++)
{
/*  ����tailָ���һ�ε�β����Ҳ���Ƕ���ʽA1(x)�Ŀ�ͷλ�á�
 *  ע�����ʽϵ���Ǵӵͽ���߽����δ洢��*/
tail = l - 1;
for(
j = 0;
j<count;
j++)
{
b[tail]=b[tail]-1.0;    /* ���Ҫ��ȥ1��ֵ�����������㷨˵����ÿ�ηֽ�ʱ��b*/
for(
kk = 1;
kk<l;
kk++)   /* ʹ�����ѭ��������㷨˵�����A0 = A0-b*A1*/
b[tail-kk] = b[tail-kk]-b[tail]*b[tail-kk+l];
tail = tail + 2 * l;      /* tailָ����һ�������ε�β��*/
}
l = l >> 1;            /* ÿ�εĳ��ȼ���*/
count = count << 1;         /* �ֶε���������һ��*/
}
for(
kk = 0;
kk<m;
kk++)
{
t1 = x[kk];
/* ��һ�ε�������ӵĽ������ax�С�
 * ��������˷ֽ�õ���һ�ζ���ʽ������*/
for(
i = 0;
i<nk;
i++)
ax[i] = t1+b[2*i];

/* ���µĴ��뿪ʼ��ϵ���ֽ����˳�����
* �ֽ��Ķ���ʽ�����ɶԣ���ΪA0��A1*/

tail = 1;                   /* ��ax[j]ָ�����A0����ֵ�����ax[j+tail]ָ�����A1����ֵ���*/
l = 2;                   /* l�ĳ�ʼֵ��2*/
t2 = t1;                 /* t2�Ǿ��Ǵ���ֵ��x*/
/* �ϲ�k-1�Σ������ֵ
* ÿ�κϲ���Ҫ��bֵ��b�ж�Ӧλ��Ѱ��
* ÿ���κϲ��Ľ����������������ǰ���λ��
* �������Ľ�������ax[0]��*/
for(
i = 1;
i<k;
i++)
{
t2 = t2 * t2;              /* ÿ�������һ���Ķ���ʽ��ʱ��x�����Ϊԭ����ƽ��*/
/* �����б����Ķ���ʽ�Խ������*/
for(
j = 0;
j<nk;
j = j + l
)
ax[j] = ax[j]+ax[j+tail]*(t2+b[2*(j+tail)-1]);
tail = tail << 1;        /* ���ڵĶ���ʽ���ȱ�Ϊ֮ǰ��������*/
l = l << 1;              /* ���ڵĶ���ʽ���ȱ�Ϊ֮ǰ��������*/
}
t2 = t2 * t2 / t1;           /* ����b[nn-1]=1��Ӱ��*/
if(nn!=n)
ax[0] -=
t2;
y[kk]=ax[0]*
a1;          /* ����ϵ����1��������Ӱ��*/
}
free(b);
free(ax);
return(1);
}
