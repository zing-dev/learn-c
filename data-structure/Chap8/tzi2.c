#include "math.h"

/*======================================================
// ��������tzi2
// ��������������Ӧ���������
// ���������a �������ޣ�b ��������,
//           n0 ��ʼ������
//           eps ����Ҫ��
//           h0 ��С����
//           f ָ�򱻻�������ָ��
// ����ֵ��  ���ֽ���ֵ
=========================================================*/
double tzi2(a, b, n0, eps, h0, f)

double a, b, eps, h0;
int n0;

double (*f)();

{
int n, k;
double z, h, t;
double x0, x1, y0, y1;

double subtz();

n = n0;                                  /* ��ʼ�Ļ�����*/
h = (b - a) / n;                             /* ��ó�ʼ����*/
z = 0.0;
for(
k = 0;
k<n;
k++)
{
x0 = a + k * h;                            /* �����������������˵�*/
x1 = a + (k + 1) * h;
y0 = (*f)(x0);                         /* ��������������˵ĺ���ֵ*/
y1 = (*f)(x1);
t = h * (y0 + y1) / 2.0;                    /* �����������ϵĻ��ֽ���ֵ*/
t = subtz(x0, x1, y0, y1, h, t, eps / n, h0, f); /* �����Ӻ������������ϵĻ��ֽ���ֵ*/
z = z + t;
}
return(z);
}

static double subtz(x0, x1, y0, y1, h, t, eps, h0, f)
double x0, x1, y0, y1, h, t;
double eps, h0;

double (*f)();

{
double x, y, t1, t2, d, z;
x = x0 + h / 2.0;                            /* ������е�*/
y = (*f)(x);                             /* �����е�ĺ���ֵ*/
t1 = h * (y0 + y) / 4.0;
t2 = h * (y + y1) / 4.0;                       /* ����������Ļ��ֽ���ֵ*/
d = fabs(t - (t1 + t2));
if((d<eps)||(h>h0))
z = t1 + t2;                             /* �Ѿ����㾫��Ҫ��������������*/
else
{
t1 = subtz(x0, x, y0, y, h / 2.0, t1, eps / 2.0, h0, f);
t2 = subtz(x, x1, y, y1, h / 2.0, t2, eps / 2.0, h0, f);
z = t1 + t2;                             /* ��������������Ļ��ֽ���ֵ֮��*/
}
return(z);
}
