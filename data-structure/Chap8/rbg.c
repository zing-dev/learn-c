#include "math.h"

/*======================================================
// ��������rbg
// ������������������ַ������
// ���������a �������ޣ�b ��������,
//           n0 ��ʼ������
//           eps ����Ҫ��
//           h0 ��С����
//           f ָ�򱻻�������ָ��
// ����ֵ��  ���ֽ���ֵ
=========================================================*/
double rbg(a, b, n0, eps, f)

double a, b, eps;
int n0;

double (*f)();

{
int n, k, m;
double r[10], z, q, h, d, x, t;
m = 1;
n = n0;                            /* ��ʼ�Ļ�����*/
h = (b - a) / n;                       /* ��ó�ʼ����*/
z = ((*f)(a) + (*f)(b)) / 2.0;         /* �����ʼ�Ļ���ֵ*/
for(
k = 1;
k<n;
k++)
{
x = a + k * h;
z = z + (*f)(x);                   /* �۴����*/
}
r[0] =
z *h;                        /* �������ٳ˷�����*/
do
{
z = 0.0;
for(
k = 0;
k<n;
k++)               /* ���������ʽ*/
{
x = a + (k + 0.5) * h;
z = z + (*f)(x);
}
z = (r[0] + h * z) / 2.0;              /* �����µĻ���ֵ*/
t = 1.0;
for(
k = 1;
k<m+1; k++)             /* ������ʽ���Ƽ���*/
{
t = 4.0 * t;
q = (t * z - r[k - 1]) / (t - 1.0);
r[k-1] =
z;
z = q;
}
d = fabs(q - r[m - 1]);              /* �������λ���ֵ�Ĳ�*/
r[m] =
q;                        /* ����������ʽ����ֵ*/
m = m + 1;
h = h / 2.0;                       /* ���²���*/
n = 2 * n;                         /* ���»�����*/
}while((d>eps)&&(m<10));
return(q);
}
