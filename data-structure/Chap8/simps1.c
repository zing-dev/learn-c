#include "math.h"

/*======================================================
// ��������simps1
// �����������䲽�������������
// ���������a �������ޣ�b ��������,
//           n0 ��ʼ������
//           eps ����Ҫ��
//           h0 ��С����
//           f ָ�򱻻�������ָ��
// ����ֵ��  ���ֽ���ֵ
=========================================================*/
double simps1(a, b, n0, eps, h0, f)

double a, b, eps, h0;
int n0;

double (*f)();

{
int n, k;
double z, z2, s, s2, h, d, x;
n = n0;                            /* ��ʼ�Ļ�����*/
h = (b - a) / n;                       /* ��ó�ʼ����*/
z = ((*f)(a) + (*f)(b)) / 2.0;         /* �����ʼ�Ļ���ֵ*/
for(
k = 1;
k<n;
k++)
{
x = a + k * h;
z = z + (*f)(x);                   /* �۴����*/
}
z = z * h;                           /* �������ٳ˷�����*/
s = z;
do
{
z2 = 0.0;
for(
k = 0;
k<n;
k++)
{
x = a + (k + 0.5) * h;               /* �ۼӼ���*/
z2 = z2 + (*f)(x);
}
z2 = (z + h * z2) / 2.0;
s2 = (4.0 * z2 - z) / 3.0;             /* �����µĻ���ֵ*/
d = fabs(s2 - s);                  /* �������λ���ֵ�Ĳ�*/
z = z2;
s = s2;                          /* ���»���ֵ*/
h = h / 2.0;                       /* ���²���*/
n = 2 * n;                         /* ���»�����*/
}while((d>eps)&&(h>h0));
return(s);
}
