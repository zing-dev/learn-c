#include "math.h"

/*======================================================
// ��������leg1
// �������������õ�-��˹�����
// ���������a �������ޣ�b ��������,
//           n0 ��ʼ������
//           eps ����Ҫ��
//           h0 ��С����
//           f ָ�򱻻�������ָ��
// ����ֵ��  ���ֽ���ֵ
=========================================================*/
double leg1(a, b, n0, eps, h0, f)

double a, b, eps, h0;
int n0;

double (*f)();

{
int n, i, j;
double z, z2, h, d, x;
static double t[5] = {-0.906179845938664, -0.538469310105683, 0.0,
                      0.538469310105683, 0.906179845938664}; /* 5�����õ¶���ʽ�����*/
static double c[5] = {0.2369268851, 0.4786286705, 0.5688888889,
                      0.4786286705, 0.2369268851};    /* ʹ��5�����õ¶���ʽʱ�Ĳ���*/
n = n0;                            /* ��ʼ�Ļ�����*/
h = (b - a) / n;                       /* ��ó�ʼ����*/
z = 0.0;                           /* �����ʼ�Ļ���ֵ*/
for(
i = 0;
i<n;
i++)
{
x = a + i * h + h / 2.0;
for(
j = 0;
j<5; j++)
z = z + c[j] * (*f)(h / 2.0 * t[j] + x);
}
z = z * h / 2.0;
do
{
n = 2 * n;                          /* ���»�����*/
h = h / 2.0;                        /* ���²���*/
z2 = 0.0;                         /* �����µĻ���ֵ*/
for(
i = 0;
i<n;
i++)
{
x = a + i * h + h / 2.0;
for(
j = 0;
j<5; j++)
z2 = z2 + c[j] * (*f)(h / 2.0 * t[j] + x);
}
z2 = z2 * h / 2.0;                   /* �������ٳ˷�����*/
d = fabs(z2 - z);                  /* �������λ���ֵ�Ĳ�*/
z = z2;                          /* ���»���ֵ*/
}while((d>eps)&&(h>h0));
return(z);
}
