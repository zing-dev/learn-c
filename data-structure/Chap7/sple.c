/*======================================================
// ��������sple
// �����������Ⱦ�⻬��ֵ
// ���������x �Ⱦ���ĵ�һ��ֵ, h �Ⱦ���ľ���
//           y ָ����n�����ĺ���ֵ�������ָ��
//           n ������
//           t ָ���Ĳ�ֵ��,eps ����ֵС�ڴ�ֵ��������Ϊ��0
// ����ֵ��  ��ָ����ֵ��ĺ�������ֵ
=========================================================*/
#include "stdio.h"
#include "math.h"

double sple(x, h, y, n, t, eps)

double x, h, *y, t, eps;
int n;
{
int k;
double z, d[5], p[4], yy[2];
double tmp1, tmp2;
if((y==NULL))                    /* �������ָ���Ƿ�Ϊ��*/
{
printf("Pointer is Null\n");
return(0.0);
}
if(n<1)                                     /* û���ṩ��㣬����0.0*/
return(0.0);
if(n==1)                                    /* ֻ��һ����㣬���ش˺���ֵ*/
return(y[0]);
if(n==2)                                    /* ֻ��������㣬ʹ�����Բ�ֵ*/
{
z = (y[0] * (t - x - h) - y[1] * (t - x)) / h;
return(z);
}
k = 0;
while(((x+
k *h
)<t)&&(k<n))                      /* Ѱ�Һ��ʵ�����*/
k++;
k = k - 1;
if(k < 1)
k = 0;
if(k==(n-1))
k = n - 2;
d[2] = (y[k+1]-y[k]);                      /* ����м����ֵ*/
if(k==0)                                    /* �жϷ�Χ������d1��d3ֵ*/
{
d[3] = (y[k+2]-y[k+1]);
d[1] = 2*d[2]-d[3];
}
else if(k==(n-2))
{
d[1] = (y[k]-y[k-1]);
d[3] = 2*d[2]-d[1];
}
else
{
d[1] = (y[k]-y[k-1]);
d[3] = (y[k+2]-y[k+1]);
}
if(k<=1)                                    /* ���d0ֵ*/
d[0] = 2*d[1]-d[2];
else
d[0] = (y[k-1]-y[k-2]);
if(k>=(n-3))                                /* ���d4ֵ*/
d[4] = 2*d[3]-d[2];
else
d[4] = (y[k+3]-y[k+2]);
tmp1 = fabs(d[3] - d[2]);                     /* ����ڵ�k��k+1������㴦�ĵ���*/
tmp2 = fabs(d[0] - d[1]);
if((tmp1 + tmp2)<eps)
yy[0] = (d[1]+d[2])/2.0;
else
yy[0] = (
tmp1 *d[1]
+
tmp2 *d[2]
)/(tmp1 + tmp2);
tmp1 = fabs(d[3] - d[4]);
tmp2 = fabs(d[2] - d[1]);
if((tmp1+tmp2)<eps)
yy[1] = (d[2]+d[3])/2.0;
else
yy[1] = (
tmp1 *d[2]
+
tmp2 *d[3]
)/(tmp1 + tmp2);
p[0] = y[k];                               /* ������õĵ����������ʽ*/
p[1] = yy[0]/
h;
p[2] = (3.0*d[2] - 2.0*yy[0] - yy[1])/(
h *h
);
p[3] = (yy[0]+yy[1]-2.0*d[2])/(
h *h
*h);
tmp1 = t - x - k * h;
z = p[0] + ((p[3] * tmp1 + p[2]) * tmp1 + p[1]) * tmp1;  /* ���ն���ʽ��ý���ֵ*/
return(z);
}
