#include "stdio.h"
#include "math.h"

/*======================================================
// ��������atken
// �������������ؽ��ֵ
// ���������x ָ����n���������ݵ������ָ��
//           y ָ����n�����ĺ���ֵ�������ָ��
//           n ������
//           t ָ���Ĳ�ֵ��, eps С�ڴ�����ֵ��Ϊ��0
// ����ֵ��  ��ָ����ֵ��ĺ�������ֵ
=========================================================*/
double atken(x, y, n, t, eps)

double *x, *y, t, eps;
int n;
{
int i, j, k, m;
double z, d, xx[8], yy[8];
if((x==NULL)||(y==NULL))                   /* �������ָ���Ƿ�Ϊ��*/
{
printf("Pointer is Null\n");
return(0.0);
}
if(n<1)                                    /* û���ṩ���ݵ�ʱ������0*/
return(0.0);
if(n==1)                                   /* ֻ��һ�����ݵ�ʱ���ͷ��������*/
return(y[0]);
if(n==2)                                   /* ֻ���������ݵ�ʱ����Ҫ��*/
{
k = 0;
m = 2;
}
else if(t<x[2])                         /* �д��ڵ���3�����ݵ�ʱ����Ե�����*/
{
k = 0;
m = 3;
}
else if(t > x[n-3])                       /* ���ݴ��ڽϴ�ı�Ե�����*/
{
k = n - 3;
m = 3;
}
else
{
k = 0;
m = n - 1;                          /* ���ַ�Ѱ�Һ��ʵ�����*/
while((m-k) > 1)
{
j = (k + m) / 2;
if(x[j] < t)
k = j;
else
m = j;
}
if(n>7)
{
if(k<4)                                /* ��ֵ�����м�*/
{
k = 0;
m = 2 * m;
}
else if(k>(n-5))                       /* ��ֵ�����м�*/
{
m = 2 * (n - 1 - k);
k = n - m;
}
else
{
k = k - 3;
m = 8;
}                    /* ��ֵ�����м�,��ʱn>=k+5*/
}
else
{
k = 0;
m = n;
}
}
printf("atken: %d,%d\n",k,k+m-1);
for(
i = 0;
i<m;
i++)                            /* ��ʹ�õ�m������ת����xx,yy��*/
{
xx[i]=x[k+i];
yy[i]=y[k+i];
}
i = 1;
do                                          /* ���ؽ��𲽲�ֵ*/
{
z = yy[i];
for(
j = 0;
j<i;
j++)
z = yy[j] + (t - xx[j]) * (yy[j] - z) / (xx[j] - xx[i]);
yy[i]=
z;
d = fabs(yy[i] - yy[i - 1]);                  /* �Ƚ����β�ֵ�Ľ��*/
i++;
}
while ((i<m)&&(d>eps));                     /* ����Ƿ����㾫��Ҫ��*/
return(z);
}
